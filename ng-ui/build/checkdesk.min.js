/*! checkdesk - v0.1.0 */
var app=angular.module("cd",["pascalprecht.translate","cd.l10n","cd.translationUI","cd.page","cd.services","cd.user","cd.liveblog","cd.report","cd.story"]),cdServices=angular.module("cd.services",["ngResource","cd.csrfToken"]),cdUser=angular.module("cd.user",["pascalprecht.translate"]),cdLiveblog=angular.module("cd.liveblog",["pascalprecht.translate"]),cdPage=angular.module("cd.page",["pascalprecht.translate"]),cdReport=angular.module("cd.report",["pascalprecht.translate"]),cdStory=angular.module("cd.story",["pascalprecht.translate"]);app.config(["$routeProvider","$locationProvider",function(e,r){r.html5Mode(!0).hashPrefix("!"),e.when("/user/register",{templateUrl:"templates/user/userForm.html",controller:"UserFormCtrl"}),e.when("/user/login",{templateUrl:"templates/user/userLogin.html",controller:"UserLoginCtrl"}),e.when("/user/password",{templateUrl:"templates/user/userForgotPassword.html",controller:"UserForgotPasswordCtrl"}),e.when("/user/:uid",{templateUrl:"templates/user/userProfile.html",controller:"UserProfileCtrl"}),e.when("/user/:uid/edit",{templateUrl:"templates/user/userForm.html",controller:"UserFormCtrl"}),e.when("/liveblog",{templateUrl:"templates/liveblog.html",controller:"LiveblogCtrl"}),e.when("/reports",{templateUrl:"templates/reports.html",controller:"ReportsCtrl"}),e.when("/report/add",{templateUrl:"templates/reportForm.html",controller:"ReportFormCtrl"}),e.when("/report/:nid",{templateUrl:"templates/report.html",controller:"ReportCtrl"}),e.when("/report/:nid/edit",{templateUrl:"templates/reportForm.html",controller:"ReportFormCtrl"}),e.otherwise({redirectTo:"/liveblog"})}]),angular.module("cd.csrfToken",[]).config(["$httpProvider",function(e){e.defaults.xsrfCookieName="CSRF-Token",e.defaults.xsrfHeaderName="X-CSRF-Token"}]),angular.module("cd.l10n",["ngCookies","pascalprecht.translate","cd.translationUI"]).config(["$translateProvider",function(e){e.useUrlLoader("api/i18n?textgroup=ui&angular=1"),e.preferredLanguage("ar"),e.useCookieStorage(),e.useMissingTranslationHandler("cdTranslationUI")}]),cdLiveblog.controller("LiveblogCtrl",["$scope","pageState","Story",function(e,r,t){r.headTitle("Liveblog"),r.title("Liveblog"),e.stories=[],t.query(function(a){for(var n=0;a.length>n;n++)e.stories.push(t.get({nid:a[n].nid}));r.status("ready")})}]),cdPage.controller("FooterCtrl",FooterCtrl=["$scope","$translate","System","User",function(e,r){e.informationMenu=[{title:r("INFORMATION_MENU_ITEM_ABOUT_TITLE"),href:"/about-checkdesk"}],e.footerMenu=[{title:r("FOOTER_MENU_ITEM_MEEDAN_TITLE"),href:"http://meedan.org"},{title:r("FOOTER_MENU_ITEM_CHECKDESK_TITLE"),href:"http://checkdesk.org"}]}]),cdPage.controller("PageCtrl",["$scope","pageState",function(e,r){e.pageState=r}]),cdPage.controller("WidgetsSidebarCtrl",["$scope",function(e){e.logoSrc="http://qa.checkdesk.org/sites/qa.checkdesk.org/files/checkdesk_theme/meedan.png",e.featuredStories=[{href:"/story/1510",title:"الشعب يريد إقالةالوزير المتحرش",imageSrc:"http://qa.checkdesk.org/sites/qa.checkdesk.org/files/styles/featured_stories_lead_image/public/adbusters_blog_occupygezi_s_2.jpg?itok=uYCbtd7B",description:'أثار رد وزير الإعلام "صلاح عبد المقصود" على سؤال أحدى الصحفيات في مؤتمر صحفي أمس ضجة كبيرة على مواقع التواصل...'}],e.followLinks=[{href:"https://www.facebook.com/YomatyEgypt",icon:"icon-facebook"},{href:"https://twitter.com/YomatyEgypt",icon:"icon-twitter"},{href:"http://www.youtube.com/user/weladelbaladlt",icon:"icon-youtube"}]}]),cdPage.controller("NavbarCtrl",["$scope","$translate","User",function(e,r,t){var a=function(e,r){switch(e){case"remove":$("html").removeClass(r);break;case"add":$("html").addClass(r)}};e.currentUser=t.currentUser,e.isLoggedIn=t.isLoggedIn,e.mainMenu=[{title:r("MAIN_MENU_ITEM_HOME_LINK"),href:"/",icon:"icon-home"},{title:r("MAIN_MENU_ITEM_REPORTS_LINK"),href:"/reports",icon:"icon-eye-open"}],e.$watch("currentUser",function(a,n){console.log([a,n],"Watching curentUser"),e.userMenu=a.uid>0?[{title:r("USER_MENU_ITEM_LOGOUT_LINK"),click:function(){t.logout({})}}]:[{title:r("USER_MENU_ITEM_LOGIN_LINK"),href:"/user/login"}]},!0),a("add",r.uses()),e.toggleLang=function(){a("remove",r.uses()),"en-NG"===r.uses()?r.uses("ar"):r.uses("en-NG"),a("add",r.uses())}}]).directive("cdMenuItem",function(){return{restrict:"A",scope:{item:"=cdMenuItem"},template:['<a href="{{item.href}}" ng-click="item.click()">','<span ng-show="item.icon" class="{{item.icon}}"></span>',"{{item.title | translate}}","</a>"].join("")}}),cdPage.factory("pageState",function(){var e="loading",r="Checkdesk",t="Checkdesk";return{status:function(r){return r&&(e=r),e},headTitle:function(e,t){return e&&(t=angular.isUndefined(t)?!0:t,r=e,t&&(r+=" | Checkdesk")),r},title:function(e){return e&&(t=e),t}}}),cdReport.controller("ReportCtrl",["$scope","$routeParams","pageState","Report","ReportActivity",function(e,r,t,a,n){e.report=a.get({nid:r.nid},function(){t.status("ready")}),e.reportActivity=n.query({args:[r.nid]})}]),cdReport.controller("ReportFormCtrl",["$scope","$routeParams","$location","Report",function(e,r,t,a){e.report=r.nid?a.get({nid:r.nid}):new a({title:"",type:"media",body:{und:[{url:""}]},field_link:{und:[{url:""}]}}),e.submit=function(){return e.report.save(function(e){t.path("/report/"+e.nid)}),!1},e.cancel=function(){r.nid?t.path("/report/"+r.nid):t.path("/")}}]),cdReport.controller("ReportsCtrl",["$scope","pageState","Report",function(e,r,t){e.reports=[],t.query(function(a){for(var n=0;a.length>n;n++)e.reports.push(t.get({nid:a[n].nid}));r.status("ready")})}]),cdServices.factory("Comment",["$resource",function(e){return e("api/node/:nid/comments",{},{query:{method:"GET",isArray:!0}})}]),cdServices.factory("Liveblog",["$resource",function(e){return e("api/views/liveblog",{},{autorefresh:{url:"sites/all/modules/custom/checkdesk_core/autorefresh/liveblog.php",method:"GET",params:{type:"discussion",field:"changed",timestamp:0},isArray:!1},query:{method:"GET",params:{display_id:"services_1",args:[]},isArray:!0}})}]),cdServices.factory("Notification",["$resource",function(e){return e("api/views/my_notifications",{},{autorefresh:{url:"sites/all/modules/custom/checkdesk_notifications/ping.php",method:"GET",params:{user:0,timestamp:0},isArray:!1},query:{method:"GET",params:{display_id:"services_1",args:[]},isArray:!0}})}]),cdServices.factory("Report",["$resource","$http",function(e){var r=e("api/node/:nid",{nid:"@nid"},{query:{method:"GET",params:{nid:"","parameters[type]":"media",pagesize:5},isArray:!0},get:{method:"GET",isArray:!1},save:{method:"POST",params:{nid:""}},update:{method:"PUT"}});return angular.extend(r.prototype,{save:function(e){return this.nid?this.$update(e):this.$save(e)}}),r}]),cdServices.factory("ReportActivity",["$resource",function(e){return e("api/views/activity_report",{},{query:{method:"GET",params:{display_id:"services_1",args:[]},isArray:!0}})}]),cdServices.factory("Story",["$resource","$http",function(e){var r=e("api/node/:nid",{nid:"@nid"},{query:{method:"GET",params:{nid:"","parameters[type]":"discussion",pagesize:5},isArray:!0},get:{method:"GET",isArray:!1},save:{method:"POST",params:{nid:""}},update:{method:"PUT"}});return angular.extend(r.prototype,{save:function(e){return this.nid?this.$update(e):this.$save(e)}}),r}]),cdServices.factory("System",["$resource",function(e){return e("api/system/:verb",{},{connect:{method:"POST",params:{verb:"connect"},isArray:!1}})}]),cdServices.factory("Translation",["$resource","$http",function(e){var r=e("api/i18n/:lid",{lid:"@lid"},{query:{method:"GET",params:{lid:"",textgroup:"ui"},isArray:!1},save:{method:"POST",params:{lid:""}},update:{method:"PUT"},remove:{method:"DELETE"}});return angular.extend(r.prototype,{save:function(e){return this.lid?this.$update(e):this.$save(e)}}),r}]),cdServices.factory("Update",["$resource","$http",function(e){var r=e("api/node/:nid",{nid:"@nid"},{query:{method:"GET",params:{nid:"","parameters[type]":"post",pagesize:5},isArray:!0},get:{method:"GET",isArray:!1},save:{method:"POST",params:{nid:""}},update:{method:"PUT"}});return angular.extend(r.prototype,{save:function(e){return this.nid?this.$update(e):this.$save(e)}}),r}]),cdServices.factory("User",["$rootScope","$resource","$http",function(e,r,t){var a,n,o,s;return n={uid:0,pass:null,name:"Anonymous"},o=angular.copy(n),s=!1,a=r("api/user/:verb",{},{login:{method:"POST",params:{verb:"login"},isArray:!1,transformResponse:t.defaults.transformResponse.concat([function(e){return angular.isObject(e)&&angular.isObject(e.user)?(o=e.user,s=!0):(o=angular.copy(n),s=!1),e}])},logout:{method:"POST",params:{verb:"logout"},isArray:!1,transformResponse:t.defaults.transformResponse.concat([function(e){return angular.isArray(e)&&e.length>0?(e[0]===!0&&(o=angular.copy(n),s=!1),{result:e[0]}):{result:!1}}])}}),a.isLoggedIn=s,a.currentUser=o,e.isLoggedIn=s,e.currentUser=o,a}]),angular.module("cd.translationUI",["pascalprecht.translate"]).provider("cdTranslationUI",function(){var e,r={},t=function(e,t){angular.isUndefined(r[t])&&(r[t]={}),angular.isUndefined(r[t][e])&&(r[t][e]="")};this.translationTable=function(r){return angular.isUndefined(r)||(e=r),e},this.missingTranslations=function(){return r},t.translationTable=this.translationTable,t.missingTranslations=this.missingTranslations,this.$get=function(){return t}}).config(["$translateProvider","cdTranslationUIProvider",function(e,r){r.translationTable(e.translations())}]).controller("cdTranslationUICtrl",["$scope","$translate","cdTranslationUI","Translation",function(e,r,t,a){e.collapsed=!0,e.toggle=function(){e.collapsed=!e.collapsed},e.$translate=r,e.cdTranslationUI=t,e.translationTable=t.translationTable(),e.missingTranslations=t.missingTranslations(),e.allTranslations={},e.languages=[],e.$watch("translationTable",function(r){e.languages=[],angular.forEach(r,function(r,t){e.languages.push(t)}),angular.forEach(r,function(r,t){angular.forEach(r,function(r,a){angular.isUndefined(e.allTranslations[a])&&(e.allTranslations[a]={}),angular.isUndefined(e.allTranslations[a][t])&&(e.allTranslations[a][t]=r),angular.forEach(e.languages,function(r){angular.isUndefined(e.allTranslations[a][r])&&(e.allTranslations[a][r]="")})})})},!0),e.$watch("missingTranslations",function(r){angular.forEach(r,function(r,t){angular.forEach(r,function(r,a){angular.isUndefined(e.allTranslations[a])&&(e.allTranslations[a]={}),angular.isUndefined(e.allTranslations[a][t])&&(e.allTranslations[a][t]=r),angular.forEach(e.languages,function(r){angular.isUndefined(e.allTranslations[a][r])&&(e.allTranslations[a][r]="")})})})},!0),e.translationChanged=function(){},e.save=function(t,n){var o;return e.allTranslations[n][t]?(o=new a({language:t,source:n,translation:e.allTranslations[n][t],textgroup:"ui"}),o.save(function(){e.translationTable[t][n]=e.allTranslations[n][t],r.uses(r.uses())}),void 0):!1}}]),cdUser.controller("UserForgotPasswordCtrl",["$scope","pageState","User",function(){}]),cdUser.controller("UserFormCtrl",["$scope","pageState","User",function(){}]),cdUser.controller("UserLoginCtrl",["$scope","$location","pageState","User",function(e,r,t,a){e.user=a.currentUser,e.isLoggedIn=a.isLoggedIn,e.submit=function(){return e.user.name&&e.user.pass?(e.user&&0!==e.user.uid?r.path("/"):a.login({username:e.user.name,password:e.user.pass},function(){e.isLoggedIn&&r.path("/")}),void 0):!1},e.cancel=function(){r.path("/")}}]),cdUser.controller("UserProfileCtrl",["$scope","pageState","User",function(){}]),cdUser.run(["User","System",function(e,r){r.connect({},function(r){angular.isObject(r)&&angular.isObject(r.user)&&(e.currentUser=r.user,e.isLoggedIn=!angular.isUndefined(r.user)&&r.user.uid>0)})}]);